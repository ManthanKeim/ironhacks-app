#!/bin/bash

BASE_DIR="$(npm prefix)"

[[ -f .npmrc ]] && source .npmrc
[[ -f .env ]] && source .env

## LOTS OF FILES INCLUDED IN NPM MODULES HAVE WRONG OR MESSED UP
## PERMISSIONS OR FILE ATTRIBUTES (ATIME/CTIME)
##
## ITS NOT CLEAR WHAT THE IMPACT OF INCONSISTENCIES ARE WITHIN A PROJECT
## BUT FIXING THEM AS SOON AS A FILE IS INSTALLED LETS US RUN A FEW
## MANAGEMENT COMMANDS WITH MUCH BETTER CONFIDENCE THAT THEY WORK THE WAY
## WE EXPECT / AND WITHOUT SKIPPING SOME FILE THAT LOOKS LIKE IT WAS CREATED
## 60 YEARS AGO.
##

# SHOULD RUN AS A POST-INSTALL HOOK BUT WE CAN MAKE THE MIN TIME VARIABLE IF NEEDED
# cmin -10 -- file changed less than ten minutes ago

# SIMPLY TOUCHING THE FILE IS ENOUGH TO MODIFY THE FILES CTIME AND THE ATIME
find node_modules/ -type f -cmin -10 -exec touch {} \;

# THERE ARE ALWAYS LOTS OF executable FILES THAT SHOULD NOT BE IN THE NPM PACKAGES
# FOR EXAMPLE ITS VERY COMMON TO  FIND README AND LICENSE FILES THAT WILL TRY TO EXECUTE
# PROGRAM CODE IF YOU RUN THEM DIRECTLY. THIS USUALLY CAUSES AN ERROR BUT DEPENDING ON THE
# FILE CONTENTS IT COULD HAVE WORSE EFFECTS
find node_modules/ -type f -executable ! -name "*.js"  -printf "%Cy%Cm%Cd:%CH:%CM:%Cs %M %u %g \033[1m\033[22m\033[00;37m%p\033[0m \033[00;33m%s\033[0m %l \n"


# OTHERS:
# OWNED BY SOMEONE OTHER THAN THE USER
# ! -user $USER
# -empty 
